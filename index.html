<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Zuordnungsspiel</title>
<style>
  body{margin:0;padding:12px;font-family:Arial;background:#fff}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
  .slot{position:relative;border:3px solid #ddd;border-radius:14px;padding:6px}
  .slot img{width:100%;display:block;border-radius:10px}
  .words{display:flex;flex-wrap:wrap;gap:12px;margin-top:18px}
  .word{
    border:3px solid #999;
    border-radius:18px;
    padding:12px 18px;
    font-size:26px;
    background:#fafafa;
    touch-action:none;
    user-select:none;
    -webkit-user-select:none;
    -webkit-touch-callout:none;
    display:inline-flex;
    transform:translate3d(0,0,0);
  }
  .blue{color:#1e6cff}
  .red{color:#d40000}
  .dragging{opacity:.96; box-shadow:0 10px 25px rgba(0,0,0,.18)}
</style>
</head>
<body>

<div class="grid">
  <div class="slot" data-word="ängstlich"><img src="img1.png"></div>
  <div class="slot" data-word="stolz"><img src="img2.png"></div>
  <div class="slot" data-word="überrascht"><img src="img3.png"></div>
  <div class="slot" data-word="traurig"><img src="img4.png"></div>
  <div class="slot" data-word="verwirrt"><img src="img5.png"></div>
  <div class="slot" data-word="dankbar"><img src="img6.png"></div>
  <div class="slot" data-word="müde"><img src="img7.png"></div>
  <div class="slot" data-word="nervös"><img src="img8.png"></div>
  <div class="slot" data-word="gelangweilt"><img src="img9.png"></div>
</div>

<div class="words" id="words"></div>

<script>
// alternating blue/red: blau-rot-blau for 3 syllables
const WORDS=[
 {w:"ängstlich", s:["ängst","lich"]},
 {w:"stolz", s:["stolz"]},
 {w:"überrascht", s:["ü","ber","rascht"]},     // blau rot blau
 {w:"traurig", s:["trau","rig"]},
 {w:"verwirrt", s:["ver","wirrt"]},
 {w:"dankbar", s:["dank","bar"]},
 {w:"müde", s:["mü","de"]},
 {w:"nervös", s:["ner","vös"]},
 {w:"gelangweilt", s:["ge","lang","weilt"]}    // blau rot blau
];

const wrap=document.getElementById("words");

function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];} return a; }

// --- speech (must be called from user gesture) ---
function speak(text){
  try{
    window.speechSynthesis.cancel();
    const u=new SpeechSynthesisUtterance(text);
    u.lang="de-DE";
    u.rate=0.95;
    window.speechSynthesis.speak(u);
  }catch(e){}
}

// --- Drag & Drop (iPad Safari stable overlay) ---
let dragEl=null, startX=0, startY=0, baseLeft=0, baseTop=0, moved=false;

function backToWords(el){
  el.classList.remove("dragging");
  el.style.position="relative";
  el.style.left=""; el.style.top=""; el.style.zIndex="";
  wrap.appendChild(el);
}

function placeOnSlot(el,slot){
  el.classList.remove("dragging");
  el.style.position="relative";
  el.style.left=""; el.style.top=""; el.style.zIndex="";
  slot.appendChild(el);
}

function onDown(e){
  e.preventDefault();
  dragEl = e.currentTarget;
  dragEl.setPointerCapture(e.pointerId);
  moved=false;

  const r=dragEl.getBoundingClientRect();
  startX=e.clientX; startY=e.clientY;
  baseLeft=r.left; baseTop=r.top;

  document.body.appendChild(dragEl);
  dragEl.classList.add("dragging");
  dragEl.style.position="fixed";
  dragEl.style.left=baseLeft+"px";
  dragEl.style.top=baseTop+"px";
  dragEl.style.zIndex=9999;
}

function onMove(e){
  if(!dragEl) return;
  e.preventDefault();
  const dx=e.clientX-startX, dy=e.clientY-startY;
  if(Math.abs(dx)+Math.abs(dy)>8) moved=true;
  dragEl.style.left=(baseLeft+dx)+"px";
  dragEl.style.top=(baseTop+dy)+"px";
}

function onUp(e){
  if(!dragEl) return;
  e.preventDefault();

  if(!moved){
    // tap => speak
    backToWords(dragEl);
    speak(dragEl.dataset.word);
    dragEl=null; 
    return;
  }

  const x=e.clientX, y=e.clientY;
  let placed=false;
  document.querySelectorAll(".slot").forEach(slot=>{
    const r=slot.getBoundingClientRect();
    if(x>=r.left&&x<=r.right&&y>=r.top&&y<=r.bottom){
      if(slot.dataset.word===dragEl.dataset.word){
        placeOnSlot(dragEl,slot);
        placed=true;
      }
    }
  });

  if(!placed) backToWords(dragEl);
  dragEl=null;
}

// Create tiles and attach pointerdown
shuffle([...WORDS]).forEach(o=>{
  const d=document.createElement("div");
  d.className="word";
  d.dataset.word=o.w;
  o.s.forEach((sy,i)=>{
    const sp=document.createElement("span");
    sp.textContent=sy;
    sp.className=(i%2===0)?"blue":"red";
    d.appendChild(sp);
  });
  d.addEventListener("pointerdown", onDown, {passive:false});
  wrap.appendChild(d);
});

document.addEventListener("pointermove", onMove, {passive:false});
document.addEventListener("pointerup", onUp, {passive:false});
document.addEventListener("pointercancel", onUp, {passive:false});
</script>
</body>
</html>
