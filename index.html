<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Zuordnungsspiel</title>
<style>
  body{margin:0;padding:12px;font-family:Arial;background:#fff; overscroll-behavior:none}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
  .card{border:3px solid #ddd;border-radius:14px;padding:8px}
  .card img{width:100%;display:block;border-radius:10px}
  .dropzone{
    margin-top:10px; min-height:60px;
    border:3px dashed #bbb; border-radius:14px;
    background:#fafafa; display:flex; align-items:center; justify-content:center;
    padding:6px; position:relative; z-index:2;
  }
  .dropzone.filled{border-style:solid}
  .words{display:flex;flex-wrap:wrap;gap:12px;margin-top:18px}
  .word{
    border:3px solid #999;border-radius:18px;padding:12px 18px;
    font-size:26px;background:#f3f3f3;
    touch-action:none; user-select:none; -webkit-user-select:none; -webkit-touch-callout:none;
    display:inline-flex; align-items:baseline;
    transform:translate3d(0,0,0);
    position:relative; z-index:1;
  }
  .blue{color:#1e6cff}
  .red{color:#d40000}
  .dragging{opacity:.96; box-shadow:0 10px 25px rgba(0,0,0,.18)}
</style>
</head>
<body>

<div class="grid" id="grid">
  <div class="card"><img src="img1.png"><div class="dropzone" data-word="verwirrt"></div></div>
  <div class="card"><img src="img2.png"><div class="dropzone" data-word="dankbar"></div></div>
  <div class="card"><img src="img3.png"><div class="dropzone" data-word="nervös"></div></div>

  <div class="card"><img src="img4.png"><div class="dropzone" data-word="überrascht"></div></div>
  <div class="card"><img src="img5.png"><div class="dropzone" data-word="müde"></div></div>
  <div class="card"><img src="img6.png"><div class="dropzone" data-word="ängstlich"></div></div>

  <div class="card"><img src="img7.png"><div class="dropzone" data-word="gelangweilt"></div></div>
  <div class="card"><img src="img8.png"><div class="dropzone" data-word="traurig"></div></div>
  <div class="card"><img src="img9.png"><div class="dropzone" data-word="stolz"></div></div>
</div>

<div class="words" id="words"></div>

<script>
const WORDS=[
 {w:"verwirrt", s:["ver","wirrt"]},
 {w:"dankbar", s:["dank","bar"]},
 {w:"nervös", s:["ner","vös"]},
 {w:"überrascht", s:["ü","ber","rascht"]},      // blau-rot-blau
 {w:"müde", s:["mü","de"]},
 {w:"ängstlich", s:["ängst","lich"]},
 {w:"gelangweilt", s:["ge","lang","weilt"]},    // blau-rot-blau
 {w:"traurig", s:["trau","rig"]},
 {w:"stolz", s:["stolz"]}
];

const wrap=document.getElementById("words");
function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];} return a; }

function speak(text){
  try{
    window.speechSynthesis.cancel();
    const u=new SpeechSynthesisUtterance(text);
    u.lang="de-DE"; u.rate=0.95;
    window.speechSynthesis.speak(u);
  }catch(e){}
}

shuffle([...WORDS]).forEach(o=>{
  const d=document.createElement("div");
  d.className="word";
  d.dataset.word=o.w;
  o.s.forEach((sy,i)=>{
    const sp=document.createElement("span");
    sp.textContent=sy;
    sp.className=(i%2===0)?"blue":"red"; // alternating, start blue
    d.appendChild(sp);
  });
  wrap.appendChild(d);
});

let dragEl=null, startX=0, startY=0, baseLeft=0, baseTop=0, moved=false;

function backToWords(el){
  el.classList.remove("dragging");
  el.style.position="relative";
  el.style.left=""; el.style.top=""; el.style.zIndex="";
  el.style.pointerEvents="auto";
  wrap.appendChild(el);
}
function placeIntoZone(el, zone){
  const existing = zone.querySelector(".word");
  if(existing){ backToWords(existing); }
  zone.appendChild(el);
  zone.classList.add("filled");
  el.classList.remove("dragging");
  el.style.position="relative";
  el.style.left=""; el.style.top=""; el.style.zIndex="";
  el.style.pointerEvents="auto";
}

function onDown(e){
  e.preventDefault();
  dragEl = e.currentTarget;
  dragEl.setPointerCapture(e.pointerId);
  moved=false;

  const r=dragEl.getBoundingClientRect();
  startX=e.clientX; startY=e.clientY;
  baseLeft=r.left; baseTop=r.top;

  document.body.appendChild(dragEl);
  dragEl.classList.add("dragging");
  dragEl.style.position="fixed";
  dragEl.style.left=baseLeft+"px";
  dragEl.style.top=baseTop+"px";
  dragEl.style.zIndex=9999;
}

function onMove(e){
  if(!dragEl) return;
  e.preventDefault();
  const dx=e.clientX-startX, dy=e.clientY-startY;
  if(Math.abs(dx)+Math.abs(dy)>6) moved=true;
  dragEl.style.left=(baseLeft+dx)+"px";
  dragEl.style.top=(baseTop+dy)+"px";
}

function onUp(e){
  if(!dragEl) return;
  e.preventDefault();

  if(!moved){
    speak(dragEl.dataset.word);
    backToWords(dragEl);
    dragEl=null;
    return;
  }

  const x=e.clientX, y=e.clientY;
  // make dragged element transparent for hit-test
  dragEl.querySelectorAll("*").forEach(n=>n.style.pointerEvents="none");
  dragEl.style.pointerEvents="none";
  const under = document.elementFromPoint(x, y);
  dragEl.style.pointerEvents="auto";
  dragEl.querySelectorAll("*").forEach(n=>n.style.pointerEvents="");

  const zone = under ? under.closest(".dropzone") : null;
  if(zone && zone.dataset.word === dragEl.dataset.word){
    placeIntoZone(dragEl, zone);
  }else{
    backToWords(dragEl);
  }
  dragEl=null;
}

document.querySelectorAll(".word").forEach(el=>{
  el.addEventListener("pointerdown", onDown, {passive:false});
});
document.addEventListener("pointermove", onMove, {passive:false});
document.addEventListener("pointerup", onUp, {passive:false});
document.addEventListener("pointercancel", onUp, {passive:false});
</script>

</body>
</html>
